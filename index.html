<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> * ê°•ì„ìˆ˜í•™ ì˜¤ë‹µë³´ê³ ì„œ ë§Œë“¤ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #3498db;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header h2 {
            color: #9b59b6;
            font-size: 1.8em;
        }

        /* ì…ë ¥ ì„¹ì…˜ */
        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .input-section.hide {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        .file-upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-area:hover {
            background: #ecf0f1;
            border-color: #2980b9;
        }

        .file-upload-area input[type="file"] {
            display: none;
        }

        .file-info {
            margin-top: 10px;
            color: #27ae60;
            font-weight: bold;
            font-size: 0.9em;
        }

        .uploaded-files {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 5px;
        }

        .uploaded-files div {
            padding: 5px 0;
            color: #2c3e50;
        }

        .btn-search {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ */
        .result-section {
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .dashboard-header h3 {
            font-size: 2em;
            margin: 0;
        }

        /* í•™ìƒì •ë³´ ì¹´ë“œ */
        .student-info-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 20px;
        }

        .info-box {
            padding: 18px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .info-box h4 {
            color: #2c3e50;
            font-size: 0.9em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .info-box p {
            color: #2c3e50;
            font-size: 1.4em;
            font-weight: bold;
            margin: 0;
        }

        /* ì»¨í…ì¸  ê·¸ë¦¬ë“œ (ì°¨íŠ¸ + í†µê³„) */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* ì°¨íŠ¸ ì„¹ì…˜ */
        .chart-section {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        .chart-container {
            max-width: 280px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 10px;
        }

        .chart-difficulty-info {
            margin-top: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9em;
            color: #2c3e50;
            font-weight: 500;
        }

        .chart-difficulty-info span {
            margin: 0 8px;
            font-weight: 600;
        }

        /* ì·¨ì•½ ìœ í˜• TOP3 ì¹´ë“œ */
        .weak-topics-card {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .weak-topics-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        .weak-topic-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 5px solid #e74c3c;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .weak-topic-item:nth-child(2) { border-left-color: #e67e22; }
        .weak-topic-item:nth-child(3) { border-left-color: #f39c12; }

        .weak-topic-rank {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .weak-topic-name {
            color: #2c3e50;
            font-size: 1em;
            margin-bottom: 3px;
            font-weight: 600;
        }

        .weak-topic-count {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* ë‚œì´ë„ìš”ì•½ */
        .difficulty-summary {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .difficulty-summary p {
            color: #2c3e50;
            font-size: 1.1em;
            margin: 0;
            font-weight: 600;
        }

        .difficulty-summary span {
            font-weight: bold;
            margin: 0 5px;
            color: #555;
        }

        .difficulty-summary .easy { color: #555; }
        .difficulty-summary .medium { color: #555; }
        .difficulty-summary .hard { color: #555; }

        /* í…Œì´ë¸” ì„¹ì…˜ */
        .table-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
        }

        .table-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: left;
        }

        .problem-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        .problem-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .problem-table th {
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .problem-table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .problem-table tbody tr:hover {
            background: #f8f9fa;
        }

        .problem-table .col-number {
            width: 10%;
            text-align: center;
            font-weight: bold;
            color: #3498db;
        }

        .problem-table .col-topic {
            width: 25%;
        }

        .problem-table .col-intent {
            width: 30%;
        }

        .problem-table .col-point {
            width: 35%;
        }

        /* í•™ìƒ ë§ì¶¤ ë¶„ì„ ì„¹ì…˜ */
        .analysis-section {
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .analysis-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: bold;
            text-align: left;
        }

        .weakness-section {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        }

        .solution-section {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        .comment-section {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
        }

        .weakness-item,
        .solution-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .weakness-item h4,
        .solution-item h4 {
            color: #e74c3c;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .weakness-item p,
        .solution-item p {
            color: #2c3e50;
            line-height: 1.8;
            margin: 8px 0;
        }

        .solution-item ul {
            margin: 10px 0;
            padding-left: 25px;
        }

        .solution-item li {
            color: #2c3e50;
            line-height: 1.8;
            margin: 5px 0;
        }

        .teacher-comment-box {
            background: white;
            border-radius: 10px;
            padding: 25px;
            line-height: 2;
            color: #2c3e50;
            font-size: 1.05em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .teacher-comment-box p {
            margin: 15px 0;
        }

        .teacher-signature {
            text-align: right;
            font-weight: bold;
            color: #9b59b6;
            margin-top: 20px;
        }

        .btn-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-new-report,
        .btn-print,
        .btn-save-html {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s;
        }

        .btn-new-report {
            background: #3498db;
            color: white;
        }

        .btn-new-report:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-print {
            background: #27ae60;
            color: white;
        }

        .btn-print:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-save-html {
            background: #9b59b6;
            color: white;
        }

        .btn-save-html:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }

        @media print {
            /* ê¸°ë³¸ ì„¤ì • */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            body {
                background: white;
                padding: 0;
                font-size: 9pt;
            }

            .container {
                max-width: 100%;
                padding: 10px;
                box-shadow: none;
            }

            /* í—¤ë” ì¶•ì†Œ */
            .header {
                margin-bottom: 10px;
            }

            .header h1 {
                font-size: 16pt;
                margin-bottom: 3px;
            }

            .header h2 {
                font-size: 12pt;
            }

            .dashboard-header {
                padding: 8px;
                margin-bottom: 10px;
            }

            .dashboard-header h3 {
                font-size: 14pt;
                margin: 0;
            }

            /* í•™ìƒì •ë³´ ì¹´ë“œ ì••ì¶• */
            .student-info-card {
                padding: 8px;
                margin-bottom: 10px;
                gap: 8px;
            }

            .info-box {
                padding: 6px;
            }

            .info-box h4 {
                font-size: 8pt;
                margin-bottom: 3px;
            }

            .info-box p {
                font-size: 11pt;
            }

            /* ì»¨í…ì¸  ê·¸ë¦¬ë“œ ì¶•ì†Œ */
            .content-grid {
                gap: 10px;
                margin-bottom: 10px;
            }

            .chart-section,
            .weak-topics-card {
                padding: 10px;
            }

            .chart-section h3,
            .weak-topics-card h3 {
                font-size: 10pt;
                margin-bottom: 8px;
            }

            .chart-container {
                max-width: 150px;
                padding: 5px;
            }

            .chart-difficulty-info {
                margin-top: 8px;
                padding: 6px;
                font-size: 7pt;
            }

            .chart-difficulty-info span {
                margin: 0 4px;
            }

            .weak-topic-item {
                padding: 6px;
                margin-bottom: 5px;
            }

            .weak-topic-rank {
                font-size: 9pt;
                margin-bottom: 2px;
            }

            .weak-topic-name {
                font-size: 9pt;
                margin-bottom: 2px;
            }

            .weak-topic-count {
                font-size: 8pt;
            }

            /* ë‚œì´ë„ ìš”ì•½ ì¶•ì†Œ */
            .difficulty-summary {
                padding: 8px;
                margin-bottom: 10px;
            }

            .difficulty-summary p {
                font-size: 9pt;
            }

            /* í…Œì´ë¸” ì¶•ì†Œ */
            .table-section {
                padding: 10px;
                margin-bottom: 10px;
            }

            .table-section h3 {
                font-size: 10pt;
                margin-bottom: 8px;
            }

            .problem-table {
                font-size: 8pt;
            }

            .problem-table th,
            .problem-table td {
                padding: 4px 6px;
            }

            .problem-table th {
                font-size: 8pt;
            }

            /* ë¶„ì„ ì„¹ì…˜ ì¶•ì†Œ */
            .analysis-section {
                padding: 10px;
                margin-bottom: 10px;
                page-break-inside: avoid;
            }

            .analysis-section h3 {
                font-size: 11pt;
                margin-bottom: 8px;
            }

            .weakness-item,
            .solution-item {
                padding: 8px;
                margin-bottom: 6px;
            }

            .weakness-item h4,
            .solution-item h4 {
                font-size: 9pt;
                margin-bottom: 4px;
            }

            .weakness-item p,
            .solution-item p {
                font-size: 8pt;
                line-height: 1.4;
                margin: 3px 0;
            }

            .solution-item ul {
                margin: 4px 0;
                padding-left: 15px;
            }

            .solution-item li {
                font-size: 8pt;
                line-height: 1.4;
                margin: 2px 0;
            }

            /* ì„ ìƒë‹˜ ì½”ë©˜íŠ¸ ì¶•ì†Œ */
            .teacher-comment-box {
                padding: 10px;
                font-size: 8pt;
                line-height: 1.5;
            }

            .teacher-comment-box p {
                margin: 6px 0;
            }

            .teacher-signature {
                font-size: 8pt;
                margin-top: 8px;
            }

            /* ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
            .btn-actions {
                display: none;
            }

            /* ì…ë ¥ ì„¹ì…˜ ìˆ¨ê¸°ê¸° */
            .input-section {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ë‹¤ì‚°ë¯¸ë˜í•™ì› * ê°•ì„T</h1>
            <h2>ì˜¤ë‹µë³´ê³ ì„œ ê´€ë¦¬ì‹œìŠ¤í…œ</h2>
        </div>

        <!-- ì…ë ¥ ì„¹ì…˜ -->
        <div class="input-section" id="inputSection">
            <div style="text-align: right; margin-bottom: 15px;">
                <a href="reports.html" style="color: #3498db; text-decoration: none; font-weight: bold; font-size: 1.1em;">
                    ğŸ“š ì €ì¥ëœ ë³´ê³ ì„œ ëª©ë¡ ë³´ê¸° â†’
                </a>
            </div>
            <div class="form-group">
                <label>ë©”íƒ€ë””ë¹„ ì—…ë¡œë“œ (ì—¬ëŸ¬ ë‹¨ì› ì„ íƒ ê°€ëŠ¥)</label>
                <label class="file-upload-area" for="csvFiles">
                    <div style="font-size: 1.2em; color: #3498db; margin-bottom: 10px;">
                        ğŸ“ CSV íŒŒì¼ ì„ íƒí•˜ê¸°
                    </div>
                    <div style="font-size: 0.9em; color: #7f8c8d;">
                        í´ë¦­í•˜ì—¬ ì—¬ëŸ¬ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”
                    </div>
                    <input type="file" id="csvFiles" accept=".csv" multiple onchange="handleFileUpload(event)">
                </label>
                <div class="uploaded-files" id="uploadedFiles" style="display: none;"></div>
            </div>

            <div class="form-group">
                <label for="studentSelect">í•™ìƒ ì„ íƒ</label>
                <select id="studentSelect">
                    <option value="">í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>

            <div class="form-group">
                <label for="unitSelect">ë‹¨ì› ì„ íƒ (ì„ íƒì‚¬í•­)</label>
                <select id="unitSelect">
                    <option value="">ì „ì²´</option>
                </select>
            </div>

            <div class="form-group">
                <label for="problemNumbers">ì˜¤ë‹µ ë²ˆí˜¸ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                <input type="text" id="problemNumbers" placeholder="ì˜ˆ: 546, 551, 600, 620">
            </div>

            <button class="btn-search" onclick="generateReport()">ì˜¤ë‹µë³´ê³ ì„œ ìƒì„±</button>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ (ëŒ€ì‹œë³´ë“œ) -->
        <div class="result-section" id="resultSection">
            <div class="dashboard-header">
                <h3>ì˜¤ë‹µë³´ê³ ì„œ</h3>
            </div>

            <!-- í•™ìƒì •ë³´ ì¹´ë“œ -->
            <div class="student-info-card">
                <div class="info-box">
                    <h4>ğŸ‘¤ í•™ìƒ ì´ë¦„</h4>
                    <p id="studentName">-</p>
                </div>
                <div class="info-box">
                    <h4>ğŸ“ í•™ë…„</h4>
                    <p id="studentGrade">-</p>
                </div>
                <div class="info-box">
                    <h4>ğŸ« í•™êµ</h4>
                    <p id="studentSchool">-</p>
                </div>
                <div class="info-box">
                    <h4>ğŸ“š ë‹¨ì›</h4>
                    <p id="unitName">-</p>
                </div>
            </div>

            <!-- ì»¨í…ì¸  ê·¸ë¦¬ë“œ (ì°¨íŠ¸ + ì·¨ì•½ ìœ í˜•) -->
            <div class="content-grid">
                <!-- ì™¼ìª½: ì°¨íŠ¸ ì„¹ì…˜ -->
                <div class="chart-section">
                    <h3 id="chartTitle">ğŸ“Š ì˜¤ë‹µ/ì •ë‹µ ë¹„ìœ¨</h3>
                    <div class="chart-container">
                        <canvas id="ratioChart"></canvas>
                    </div>
                    <div class="chart-difficulty-info" id="chartDifficultyInfo">
                        <!-- ë‚œì´ë„ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½: ì·¨ì•½ ìœ í˜• TOP3 -->
                <div class="weak-topics-card">
                    <h3>âš ï¸ ì·¨ì•½ ìœ í˜• TOP 3</h3>
                    <div id="weakTopicsList">
                        <div class="weak-topic-item">
                            <div class="weak-topic-rank">1ìœ„</div>
                            <div class="weak-topic-name">-</div>
                            <div class="weak-topic-count">0ë¬¸ì œ</div>
                        </div>
                        <div class="weak-topic-item">
                            <div class="weak-topic-rank">2ìœ„</div>
                            <div class="weak-topic-name">-</div>
                            <div class="weak-topic-count">0ë¬¸ì œ</div>
                        </div>
                        <div class="weak-topic-item">
                            <div class="weak-topic-rank">3ìœ„</div>
                            <div class="weak-topic-name">-</div>
                            <div class="weak-topic-count">0ë¬¸ì œ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í…Œì´ë¸” ì„¹ì…˜ -->
            <div class="table-section">
                <h3>ğŸ“‹ ì˜¤ë‹µ ë¬¸ì œ ìƒì„¸ ëª©ë¡</h3>
                <table class="problem-table">
                    <thead>
                        <tr>
                            <th class="col-number">ë²ˆí˜¸</th>
                            <th class="col-topic">ì„¸ë¶€ì£¼ì œ</th>
                            <th class="col-intent">ì¶œì œì˜ë„</th>
                            <th class="col-point">ì˜¤ë‹µí¬ì¸íŠ¸</th>
                        </tr>
                    </thead>
                    <tbody id="problemTableBody">
                    </tbody>
                </table>
            </div>

            <!-- í•™ìƒ ë§ì¶¤ ë¶„ì„ ì„¹ì…˜ 1: ë¬´ì—‡ì´ ë¶€ì¡±í–ˆì„ê¹Œ? -->
            <div class="analysis-section weakness-section">
                <h3>ğŸ’¡ ë¬´ì—‡ì´ ë¶€ì¡±í–ˆì„ê¹Œ?</h3>
                <div id="weaknessAnalysis">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- í•™ìƒ ë§ì¶¤ ë¶„ì„ ì„¹ì…˜ 2: ê³µë¶€ ë°©ë²• ì œì•ˆ -->
            <div class="analysis-section solution-section">
                <h3>ğŸ¯ ì•ìœ¼ë¡œ ì´ë ‡ê²Œ ê³µë¶€í•´ ë³´ë©´ ë” ê°•ë ¥í•´ì§ˆ ìˆ˜ ìˆì–´!</h3>
                <div id="solutionSuggestions">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- í•™ìƒ ë§ì¶¤ ë¶„ì„ ì„¹ì…˜ 3: ë§ˆë¬´ë¦¬ ì½”ë©˜íŠ¸ -->
            <div class="analysis-section comment-section">
                <h3>ğŸ’Œ ì„ ìƒë‹˜ì˜ ì‘ì› ë©”ì‹œì§€</h3>
                <div id="teacherComment">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>

            <div class="btn-actions">
                <button class="btn-new-report" onclick="showInputSection()">âœï¸ ìƒˆë¡œìš´ ë³´ê³ ì„œ ì‘ì„±</button>
                <button class="btn-print" onclick="window.location.href='reports.html'" style="background: #f39c12;">ğŸ“š ë³´ê³ ì„œ ëª©ë¡</button>
                <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
                <button class="btn-save-html" onclick="saveAsHTML()">ğŸ’¾ HTML ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // CSV ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜
        let problemsData = [];
        let ratioChart = null;
        let uploadedFileNames = [];

        // í•™ìƒë³„ ì •ë³´ ë°ì´í„°
        // í•™ìƒ ë°ì´í„° (student.txtì—ì„œ ë™ì ìœ¼ë¡œ ë¡œë“œ)
        let studentData = {};

        // ìˆ˜í•™ë¬¸ì œ í‹€ë¦¬ëŠ” ìœ í˜•ë³„ ì„¤ëª… ë° í•´ê²°ë°©ì•ˆ
        const weaknessTypeData = {
            "ê³„ì‚° ì‹¤ìˆ˜ ë°˜ë³µí˜•": {
                emoji: "ğŸ”¢",
                description: "ì—°ì‚°, ë¶€í˜¸, ê´„í˜¸, ë‹¨ìœ„ ê°™ì€ ê³³ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ì‹¤ìˆ˜ê°€ ë‚˜ì™€. ê°œë…ì€ ì•Œê³  ìˆëŠ”ë° ìµœì¢… ì •ë‹µ ë„ë‹¬ì— ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ë§ë”ë¼. ìˆœê°„ ì§‘ì¤‘ë ¥ì´ ë–¨ì–´ì§€ê±°ë‚˜ ì„±ê²©ì ìœ¼ë¡œ ëœë ëŒ€ëŠ” í¸ì´ì•¼.",
                keywords: ["ê³„ì‚°", "ì‹¤ìˆ˜", "ì—°ì‚°", "ë¶€í˜¸", "ê´„í˜¸", "ë‹¨ìœ„", "ê²€ì‚°", "ì •í™•", "ê³„ì‚°ëŸ‰"],
                solutions: [
                    "ì‹¤ìˆ˜ ìœ í˜• ë…¸íŠ¸ ì£¼ê°„ ì‘ì„±",
                    "í’€ì´ í›„ ê²€í†  ë£¨í‹´ ê³ ì •",
                    "ì œí•œ ì‹œê°„ ë‚´ ê²€ì‚° í›ˆë ¨",
                    "ì†ë„-ì •í™•ë„ ê· í˜• ì—°ìŠµ (ì‹¤ì „ ì¡°ê±´ ìœ ì‚¬í™”)"
                ]
            },
            "í’€ì´ ì†ë„ ë¶€ì¡±í˜•": {
                emoji: "â°",
                description: "ê°œë… ì´í•´ëŠ” ë˜ì–´ ìˆëŠ”ë°, í’€ì´ íë¦„ì´ ë„ˆë¬´ ëŠë ¤. ë¬¸ì œ ë¶„ì„ë¶€í„° ì „ê°œê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì´ ê¸´ í¸ì´ê³ , ì‹œí—˜ ì‹œê°„ì´ ë¶€ì¡±í•´ì„œ í’€ì´ë¥¼ ëë‚´ì§€ ëª»í•´ ì ìˆ˜ê°€ ê¹ì´ëŠ” ê²½ìš°ê°€ ë§ì•„.",
                keywords: ["ë³µì¡", "ê³„ì‚°ëŸ‰", "ì „ê°œ", "ë‹¨ê³„", "ê³¼ì •", "ëŠë¦¼", "ì‹œê°„", "ë§", "ìˆœì„œ"],
                solutions: [
                    "ì¡°ê±´ ì •ë¦¬ ë£¨í‹´í™” (í’€ì´ ì ‘ê·¼ ì†ë„ ê°œì„ )",
                    "ì‹œê°„ ì œí•œ í…ŒìŠ¤íŠ¸ ë°˜ë³µ",
                    "ë¹ ë¥¸ í’€ì´ vs ì •í™• í’€ì´ ì´ì¤‘ ì—°ìŠµë²• ë„ì…",
                    "ë¬¸ì œ í’€ì´ëŸ‰ ì¦ëŒ€",
                    "ì‚¬ê³  ê°„ì†Œí™” ì „ëµ í›ˆë ¨"
                ]
            },
            "ê°œë… ì—°ê²° ì•½í™”í˜•": {
                emoji: "ğŸ”—",
                description: "ê°œë…ì„ ë”°ë¡œ ì™¸ìš°ê¸´ í–ˆëŠ”ë°, ë¬¸ì œ ìƒí™©ì—ì„œ ì ìš©ì„ ëª»í•´. ë¬¸ì œ í•´ì„ê³¼ ìˆ˜ì‹í™” ì‚¬ì´ ì—°ê²° ê³ ë¦¬ê°€ ì•½í•œ í¸ì´ê³ , ì„œìˆ í˜•ì´ë‚˜ ê³ ë‚œë„ ë¬¸ì œì—ì„œ ë¬¸ì œ ìƒí™©ì„ ì´í•´ ëª»í•´ì„œ ë©ˆì¶°ë²„ë ¤.",
                keywords: ["ê°œë…", "ì„±ì§ˆ", "ì •ë¦¬", "ê³µì‹", "ëª¨ë¥´ëŠ”", "íŒŒì•…í•˜ì§€ ëª»", "ì´í•´í•˜ì§€ ëª»", "ì—°ê²°", "ì ìš©", "í™œìš©"],
                solutions: [
                    'ê°œë…ì„œ ì •ë…: "ì´ê°•ì„ T ìˆ˜ê°œì‚¬" ë“± ì¶”ì²œ',
                    "ë¬¸ì œ ìƒí™© â†’ ë§/ê·¸ë¦¼ìœ¼ë¡œ ë°”ê¾¸ëŠ” í•´ì„ í›ˆë ¨",
                    "ê°œë… ìš”ì•½ ë§í•˜ê¸° â†’ ì“°ê¸° ë£¨í‹´í™”",
                    "ê°œë…-ë¬¸ì œ ë§¤ì¹­í‘œ ì •ë¦¬"
                ]
            },
            "ì¡°ê±´ í•´ì„ ì˜¤ë¥˜í˜•": {
                emoji: "ğŸ“–",
                description: "ë¬¸ì œì˜ ì¡°ê±´ì„ ë¹¼ë¨¹ê±°ë‚˜ ì˜ëª» ì½ê³  í’€ì´ ë°©í–¥ì„ ì˜ëª» ì¡ì•„. í•µì‹¬ ë‹¨ì„œë¥¼ ì¸ì‹ ëª»í•´ì„œ ì „ì²´ í’€ì´ê°€ ì—‰ëš±í•˜ê²Œ í˜ëŸ¬ê°€ê³ , ì¡°ê±´ ë¶„ì„í•˜ëŠ” ìŠµê´€ì´ ì•„ì§ ì•ˆ ì¡í˜€ ìˆì–´.",
                keywords: ["ì¡°ê±´", "ë¹¼ë¨¹", "ì˜ëª»", "ì½", "í•´ì„", "íŒŒì•…", "ì¸ì‹", "í™•ì¸", "íŒë‹¨", "ë†“ì¹¨"],
                solutions: [
                    "ì¡°ê±´ ì²´í¬ ë£¨í‹´ í›ˆë ¨",
                    "ì¡°ê±´ í‘œì‹œ(ë°‘ì¤„/ë™ê·¸ë¼ë¯¸) ì‹œê°í™” ìŠµê´€í™”",
                    "ì„œìˆ í˜• ë…í•´ + ë„ì… í•´ì„ ì§‘ì¤‘",
                    '"ì¡°ê±´ ë¹ ì§ ì‹¤ìˆ˜"ë¥¼ ë°˜ë³µì ìœ¼ë¡œ í™˜ê¸°'
                ]
            },
            "í’€ì´ ì¤‘ íë¦„ ë¶•ê´´í˜•": {
                emoji: "ğŸŒŠ",
                description: "ë¬¸ì œ ì‹œì‘ì€ ì˜í•˜ëŠ”ë°, ì¤‘ë°˜ ì´í›„ì— í’€ì´ íë¦„ì´ ëŠê²¨ë²„ë ¤. ìˆ˜ì‹ ë…¼ë¦¬ ì—°ê²°ì´ ì•½í•˜ê³ , ë§ˆë¬´ë¦¬ ëŠ¥ë ¥ì´ ë¶€ì¡±í•´. ëê¹Œì§€ ëŒê³  ê°€ëŠ” ì§‘ì¤‘ë ¥ì´ë‘ êµ¬ì¡°ì  ì‚¬ê³ ë ¥ì´ ì¢€ ë¶€ì¡±í•œ í¸ì´ì•¼.",
                keywords: ["íë¦„", "ëŠ", "ë…¼ë¦¬", "ì—°ê²°", "ì „ê°œ", "ë§ˆë¬´ë¦¬", "ëê¹Œì§€", "êµ¬ì¡°", "ì²´ê³„", "ì •ë¦¬"],
                solutions: [
                    "ì‹œì‘â†’ì¤‘ê°„â†’ë§ˆë¬´ë¦¬ í’€ì´ íë¦„ë„ ì‘ì„± ë£¨í‹´",
                    "í’€ì´ ì™„ë£Œ í›„ 'ë˜ì§šê¸°' í›ˆë ¨",
                    "ì„œìˆ í˜•ìœ¼ë¡œ í’€ì–´ê°€ëŠ” íë¦„ ë³µì› í›ˆë ¨",
                    "ë§ˆë¬´ë¦¬ ì „ 'ê²€í†  ë£¨í‹´' í™•ë¦½"
                ]
            },
            "ì‹¤ì „ ê¸´ì¥ / ì˜¤ë‹µ ê´€ë¦¬ ë¯¸í¡í˜•": {
                emoji: "ğŸ˜°",
                description: "ì‹¤ì „ì—ì„œ ê¸´ì¥í•˜ê±°ë‚˜ ì••ë°•ê° ë•Œë¬¸ì— ì‹¤ë ¥ ë°œíœ˜ë¥¼ ëª»í•´. ì˜¤ë‹µì„ ì •ë¦¬í•´ë„ ì›ì¸ ì¸ì‹ì´ë‚˜ í”¼ë“œë°± ìˆ˜ìš©ì´ ì–´ë µê³ , ì•”ê¸° ìœ„ì£¼ë¡œ ê³µë¶€í•˜ëŠ” ìŠµê´€ì´ ìˆëŠ” ê²½ìš°ê°€ ë§ì•„.",
                keywords: ["ê¸´ì¥", "ì‹¤ìˆ˜", "ì••ë°•", "ë¶ˆì•ˆ", "ì‹¬ë¦¬", "ì‹œí—˜", "ì‹¤ì „", "ì•”ê¸°", "ë°˜ë³µ"],
                solutions: [
                    "ì‹¤ì „ í…ŒìŠ¤íŠ¸ ìƒí™© ë°˜ë³µ í›ˆë ¨",
                    "ì˜¤ë‹µ ë§í•˜ê¸° ë£¨í‹´ ë„ì…",
                    "í•™ë¶€ëª¨ì™€ì˜ ì‹¬ë¦¬ ê°„ê²© ì™„í™” ìš”ì²­ í¬í•¨",
                    "ì„±ê³µ ê²½í—˜ ì œê³µ ê³¼ì œ ì„¤ê³„",
                    "ì‹œí—˜ ì§ì „ ë£¨í‹´ ê³ ì • â†’ ë§ˆì¸ë“œ ë¦¬í—ˆì„¤ ë³‘í–‰"
                ]
            }
        };

        // CSV íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ (ì—¬ëŸ¬ íŒŒì¼)
        function handleFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            let filesProcessed = 0;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                uploadedFileNames.push(file.name);

                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    parseCSV(text);

                    filesProcessed++;
                    if (filesProcessed === files.length) {
                        // ëª¨ë“  íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ
                        displayUploadedFiles();
                        alert(`${files.length}ê°œì˜ íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ! ì´ ${problemsData.length}ê°œì˜ ë¬¸ì œê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    }
                };
                reader.readAsText(file, 'UTF-8');
            }
        }

        // ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ í‘œì‹œ
        function displayUploadedFiles() {
            const uploadedFilesDiv = document.getElementById('uploadedFiles');
            if (uploadedFileNames.length > 0) {
                uploadedFilesDiv.style.display = 'block';
                uploadedFilesDiv.innerHTML = '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">' +
                    '<strong>ì—…ë¡œë“œëœ íŒŒì¼:</strong>' +
                    '<button onclick="clearAllData()" style="padding: 5px 15px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9em;">ì „ì²´ ì´ˆê¸°í™”</button>' +
                    '</div>' +
                    '<div style="margin-bottom: 10px; color: #27ae60; font-weight: bold;">ì´ ' + problemsData.length + 'ê°œì˜ ë¬¸ì œ ë¡œë“œë¨</div>' +
                    uploadedFileNames.map(name => `âœ“ ${name}`).join('<br>');
            }
        }

        // ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”
        function clearAllData() {
            if (confirm('ëª¨ë“  ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                uploadedFileNames = [];
                problemsData = [];
                document.getElementById('uploadedFiles').style.display = 'none';
                document.getElementById('csvFiles').value = '';
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // CSV íŒŒì‹±
        function parseCSV(text) {
            const lines = text.split('\n');

            // BOM ì œê±°
            let firstLine = lines[0];
            if (firstLine.charCodeAt(0) === 0xFEFF) {
                firstLine = firstLine.substr(1);
            }

            const headers = parseCSVLine(firstLine);

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;

                const values = parseCSVLine(lines[i]);
                const problem = {};

                headers.forEach((header, index) => {
                    problem[header.trim()] = values[index] ? values[index].trim() : '';
                });

                if (problem['ë¬¸ì œë²ˆí˜¸']) {
                    // ì¤‘ë³µ ì²´í¬
                    const exists = problemsData.find(p => p['ë¬¸ì œë²ˆí˜¸'] === problem['ë¬¸ì œë²ˆí˜¸']);
                    if (!exists) {
                        problemsData.push(problem);
                    }
                }
            }
        }

        // CSV ë¼ì¸ íŒŒì‹± (ë”°ì˜´í‘œ ì²˜ë¦¬)
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];

                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);

            return result;
        }

        // ì˜¤ë‹µë³´ê³ ì„œ ìƒì„±
        function generateReport() {
            const student = document.getElementById('studentSelect').value;
            const unit = document.getElementById('unitSelect').value;
            const numbersInput = document.getElementById('problemNumbers').value;

            if (!student) {
                alert('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!numbersInput.trim()) {
                alert('ì˜¤ë‹µ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (problemsData.length === 0) {
                alert('CSV íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë²ˆí˜¸ íŒŒì‹±
            const numbers = numbersInput.split(',').map(n => n.trim());

            // ì…ë ¥ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.getElementById('inputSection').classList.add('hide');

            // ê²°ê³¼ ìƒì„±
            displayDashboard(student, unit, numbers);
        }

        // ì…ë ¥ ì„¹ì…˜ ë‹¤ì‹œ ë³´ì´ê¸°
        function showInputSection() {
            document.getElementById('inputSection').classList.remove('hide');
            document.getElementById('resultSection').classList.remove('show');

            // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
        function displayDashboard(student, unit, numbers) {
            const resultSection = document.getElementById('resultSection');

            // í•™ìƒì •ë³´ ì„¤ì •
            const unitText = unit ? document.querySelector(`#unitSelect option[value="${unit}"]`).text : 'ì „ì²´ ë‹¨ì›';
            const studentInfo = studentData[student];

            document.getElementById('studentName').textContent = student;
            document.getElementById('studentGrade').textContent = studentInfo ? studentInfo.grade : '-';
            document.getElementById('studentSchool').textContent = studentInfo ? studentInfo.school : '-';
            document.getElementById('unitName').textContent = unitText;

            // ë¬¸ì œ ë°ì´í„° ìˆ˜ì§‘
            let foundProblems = [];
            numbers.forEach(num => {
                const problem = problemsData.find(p => p['ë¬¸ì œë²ˆí˜¸'] === num);
                if (problem) {
                    foundProblems.push(problem);
                }
            });

            // í†µê³„ ê³„ì‚°
            const stats = calculateStatistics(foundProblems);

            // ì·¨ì•½ ìœ í˜• TOP3 í‘œì‹œ
            displayWeakTopics(foundProblems);

            // ì°¨íŠ¸ í‘œì‹œ
            displayChart(foundProblems.length, problemsData.length, stats);

            // í…Œì´ë¸” í‘œì‹œ
            displayTable(foundProblems);

            // í•™ìƒë³„ ë§ì¶¤ ë¶„ì„ ì„¹ì…˜ í‘œì‹œ
            displayWeaknessAnalysis(student, foundProblems);
            displaySolutionSuggestions(student, foundProblems);
            displayTeacherComment(student);

            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            resultSection.classList.add('show');

            // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // í†µê³„ ê³„ì‚°
        function calculateStatistics(problems) {
            let easy = 0;
            let medium = 0;
            let hard = 0;

            problems.forEach(problem => {
                const difficulty = problem['ë‚œì´ë„'];
                if (difficulty.includes('ì‰¬')) {
                    easy++;
                } else if (difficulty.includes('ìƒ')) {
                    hard++;
                } else {
                    medium++;
                }
            });

            return {
                total: problems.length,
                easy: easy,
                medium: medium,
                hard: hard
            };
        }

        // ì·¨ì•½ ìœ í˜• TOP3 í‘œì‹œ
        function displayWeakTopics(problems) {
            // ì„¸ë¶€ì£¼ì œë³„ ì¹´ìš´íŠ¸
            const topicCount = {};
            problems.forEach(problem => {
                const topic = problem['ì„¸ë¶€ì£¼ì œ'];
                if (topic) {
                    topicCount[topic] = (topicCount[topic] || 0) + 1;
                }
            });

            // ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ê°œìˆ˜ë¡œ ì •ë ¬
            const sortedTopics = Object.entries(topicCount)
                .map(([topic, count]) => ({ topic, count }))
                .sort((a, b) => b.count - a.count);

            // TOP3 ì¶”ì¶œ
            const top3 = sortedTopics.slice(0, 3);

            // HTML ìƒì„±
            const weakTopicsList = document.getElementById('weakTopicsList');
            weakTopicsList.innerHTML = '';

            const ranks = ['âš ï¸ 1ìœ„', 'â— 2ìœ„', 'ğŸ“ 3ìœ„'];
            for (let i = 0; i < 3; i++) {
                const item = document.createElement('div');
                item.className = 'weak-topic-item';

                if (top3[i]) {
                    item.innerHTML = `
                        <div class="weak-topic-rank">${ranks[i]}</div>
                        <div class="weak-topic-name">${top3[i].topic}</div>
                        <div class="weak-topic-count">ğŸ“Œ ${top3[i].count}ë¬¸ì œ</div>
                    `;
                } else {
                    item.innerHTML = `
                        <div class="weak-topic-rank">${ranks[i]}</div>
                        <div class="weak-topic-name">-</div>
                        <div class="weak-topic-count">0ë¬¸ì œ</div>
                    `;
                }

                weakTopicsList.appendChild(item);
            }
        }

        // ì°¨íŠ¸ í‘œì‹œ
        function displayChart(wrongCount, totalCount, stats) {
            const ctx = document.getElementById('ratioChart');
            const correctCount = totalCount - wrongCount;
            const wrongPercentage = ((wrongCount / totalCount) * 100).toFixed(1);
            const correctPercentage = ((correctCount / totalCount) * 100).toFixed(1);

            // ì œëª©ì— í¼ì„¼íŠ¸ í‘œì‹œ
            document.getElementById('chartTitle').textContent =
                `ì˜¤ë‹µ/ì •ë‹µ ë¹„ìœ¨ (ì˜¤ë‹µ: ${wrongPercentage}%, ì •ë‹µ: ${correctPercentage}%)`;

            // ë‚œì´ë„ ì •ë³´ í‘œì‹œ
            const difficultyInfo = document.getElementById('chartDifficultyInfo');
            difficultyInfo.innerHTML = `
                <div>ë‚œì´ë„ë³„ ì˜¤ë‹µ:</div>
                <div style="margin-top: 5px;">
                    <span>âœ… ì‰¬ì›€ ${stats.easy}ê°œ</span>
                    <span>âš¡ ì¤‘/ì¤‘ìƒ ${stats.medium}ê°œ</span>
                    <span>ğŸ”¥ ìƒ ${stats.hard}ê°œ</span>
                </div>
            `;

            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (ratioChart) {
                ratioChart.destroy();
            }

            ratioChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['ì˜¤ë‹µ', 'ì •ë‹µ'],
                    datasets: [{
                        data: [wrongCount, correctCount],
                        backgroundColor: [
                            '#667EEA',
                            '#64B5F6'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 9,
                                    family: 'Malgun Gothic'
                                },
                                padding: 12,
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    if (data.labels.length && data.datasets.length) {
                                        return data.labels.map((label, i) => {
                                            const value = data.datasets[0].data[i];
                                            const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return {
                                                text: `${label}: ${value}ê°œ (${percentage}%)`,
                                                fillStyle: data.datasets[0].backgroundColor[i],
                                                hidden: false,
                                                index: i
                                            };
                                        });
                                    }
                                    return [];
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value}ê°œ (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ë¬¸ì œë“¤ì„ í•™ìƒì˜ í‹€ë¦¬ëŠ” ìœ í˜•ë³„ë¡œ ë§¤ì¹­
        function matchProblemsToWeaknessTypes(problems, weaknessTypes) {
            const matched = {};

            // ê° ìœ í˜•ë³„ë¡œ ë¹ˆ ë°°ì—´ ì´ˆê¸°í™”
            weaknessTypes.forEach(type => {
                matched[type] = [];
            });

            // ê° ë¬¸ì œë¥¼ ìœ í˜•ë³„ë¡œ ë¶„ë¥˜
            problems.forEach(problem => {
                const wrongPoint = problem['ì˜¤ë‹µí¬ì¸íŠ¸'] || '';

                weaknessTypes.forEach(weaknessType => {
                    const typeData = weaknessTypeData[weaknessType];
                    if (!typeData || !typeData.keywords) return;

                    // ì˜¤ë‹µí¬ì¸íŠ¸ì— ìœ í˜•ì˜ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                    const hasKeyword = typeData.keywords.some(keyword =>
                        wrongPoint.includes(keyword)
                    );

                    if (hasKeyword) {
                        matched[weaknessType].push(problem);
                    }
                });
            });

            return matched;
        }

        // í…Œì´ë¸” í‘œì‹œ
        function displayTable(problems) {
            const tableBody = document.getElementById('problemTableBody');
            tableBody.innerHTML = '';

            problems.forEach(problem => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="col-number">${problem['ë¬¸ì œë²ˆí˜¸']}</td>
                    <td class="col-topic">${problem['ì„¸ë¶€ì£¼ì œ']}</td>
                    <td class="col-intent">${problem['ì¶œì œì˜ë„']}</td>
                    <td class="col-point">${problem['ì˜¤ë‹µí¬ì¸íŠ¸']}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // í•™ìƒ ì•½ì  ë¶„ì„ í‘œì‹œ
        function displayWeaknessAnalysis(student, problems) {
            const container = document.getElementById('weaknessAnalysis');
            container.innerHTML = '';

            const studentInfo = studentData[student];
            if (!studentInfo) {
                container.innerHTML = '<p>í•´ë‹¹ í•™ìƒì˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const intro = document.createElement('p');
            intro.style.marginBottom = '20px';
            intro.style.fontSize = '1.1em';
            intro.style.lineHeight = '1.8';
            intro.innerHTML = `ì´ë²ˆì— í‹€ë¦° ë¬¸ì œë“¤ì„ ê¼¼ê¼¼í•˜ê²Œ ë¶„ì„í•´ë´¤ì–´. ì£¼ë¡œ ì´ëŸ° ë¶€ë¶„ì—ì„œ ë§‰í˜”ë”ë¼ê³ . ê°™ì´ í•œë²ˆ ì‚´í´ë³¼ê¹Œ?`;
            container.appendChild(intro);

            // ë¬¸ì œë“¤ì„ í•™ìƒì˜ ìœ í˜•ë³„ë¡œ ë§¤ì¹­
            const matchedProblems = matchProblemsToWeaknessTypes(problems, studentInfo.weaknessTypes);

            studentInfo.weaknessTypes.forEach(weaknessType => {
                const typeData = weaknessTypeData[weaknessType];
                if (!typeData) return;

                const typedProblems = matchedProblems[weaknessType] || [];

                const item = document.createElement('div');
                item.className = 'weakness-item';

                let content = `<h4>${typeData.emoji} ${weaknessType}</h4>`;
                content += `<p>${typeData.description}</p>`;

                // ì´ ìœ í˜•ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì œë“¤ì´ ìˆìœ¼ë©´ êµ¬ì²´ì ìœ¼ë¡œ í‘œì‹œ
                if (typedProblems.length > 0) {
                    content += '<div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-left: 4px solid #e74c3c; border-radius: 5px;">';
                    content += '<p style="font-weight: bold; color: #e74c3c; margin-bottom: 10px;">ğŸ“Œ ì´ëŸ° ë¬¸ì œì—ì„œ ì´ ìœ í˜• íŠ¹ì„±ì´ ë“œëŸ¬ë‚¬ì–´:</p>';

                    typedProblems.forEach(problem => {
                        content += `<p style="margin: 8px 0; line-height: 1.6;">`;
                        content += `<strong style="color: #3498db;">${problem['ë¬¸ì œë²ˆí˜¸']}ë²ˆ</strong>: `;
                        content += `${problem['ì˜¤ë‹µí¬ì¸íŠ¸']}`;
                        content += `</p>`;
                    });

                    content += '</div>';
                }

                item.innerHTML = content;
                container.appendChild(item);
            });
        }

        // í•´ê²° ë°©ì•ˆ ì œì•ˆ í‘œì‹œ
        function displaySolutionSuggestions(student, problems) {
            const container = document.getElementById('solutionSuggestions');
            container.innerHTML = '';

            const studentInfo = studentData[student];
            if (!studentInfo) {
                container.innerHTML = '<p>í•´ë‹¹ í•™ìƒì˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const intro = document.createElement('p');
            intro.style.marginBottom = '20px';
            intro.style.fontSize = '1.1em';
            intro.style.lineHeight = '1.8';
            intro.innerHTML = `ì¡°ê¸ˆë§Œ ë…¸ë ¥í•˜ë©´ ì§€ê¸ˆë³´ë‹¤ í›¨ì”¬ ë” ì„±ì¥í•  ìˆ˜ ìˆì–´! ìƒ˜ì´ íš¨ê³¼ì ì¸ ë°©ë²• ëª‡ ê°€ì§€ ì¶”ì²œí•´ì¤„ê²Œ.`;
            container.appendChild(intro);

            // ë¬¸ì œë“¤ì„ í•™ìƒì˜ ìœ í˜•ë³„ë¡œ ë§¤ì¹­
            const matchedProblems = matchProblemsToWeaknessTypes(problems, studentInfo.weaknessTypes);

            studentInfo.weaknessTypes.forEach(weaknessType => {
                const typeData = weaknessTypeData[weaknessType];
                if (!typeData) return;

                const typedProblems = matchedProblems[weaknessType] || [];

                const item = document.createElement('div');
                item.className = 'solution-item';

                let solutionHTML = `<h4>${typeData.emoji} ${weaknessType} ì´ë ‡ê²Œ ê·¹ë³µí•´ë³´ì!</h4>`;

                // ì´ ìœ í˜•ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì œê°€ ìˆìœ¼ë©´ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰
                if (typedProblems.length > 0) {
                    const problemNumbers = typedProblems.map(p => p['ë¬¸ì œë²ˆí˜¸']).join('ë²ˆ, ') + 'ë²ˆ';
                    solutionHTML += `<p style="color: #555; margin-bottom: 15px; font-weight: 500;">`;
                    solutionHTML += `íŠ¹íˆ <strong style="color: #3498db;">${problemNumbers}</strong> ë¬¸ì œì—ì„œ ì´ëŸ° ë¶€ë¶„ì´ ë‚˜íƒ€ë‚¬ìœ¼ë‹ˆ, ë‹¤ìŒ ë°©ë²•ë“¤ì„ ì‹œë„í•´ë´!`;
                    solutionHTML += `</p>`;
                }

                solutionHTML += '<ul>';
                typeData.solutions.forEach(solution => {
                    solutionHTML += `<li>âœ“ ${solution}</li>`;
                });
                solutionHTML += '</ul>';

                item.innerHTML = solutionHTML;
                container.appendChild(item);
            });
        }

        // ì„ ìƒë‹˜ ì½”ë©˜íŠ¸ í‘œì‹œ
        function displayTeacherComment(student) {
            const container = document.getElementById('teacherComment');
            container.innerHTML = '';

            const studentInfo = studentData[student];
            if (!studentInfo) {
                container.innerHTML = '<p>í•´ë‹¹ í•™ìƒì˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const commentBox = document.createElement('div');
            commentBox.className = 'teacher-comment-box';
            commentBox.innerHTML = `
                <p>${studentInfo.comment}</p>
                <p>íŠ¹íˆ "ì™œ ì´ë ‡ê²Œ í’€ë¦´ê¹Œ?" í•˜ê³  ìŠ¤ìŠ¤ë¡œ ì§ˆë¬¸í•˜ë©´ì„œ ë‹µì„ ì°¾ì•„ê°€ëŠ” ê³¼ì •ì—ì„œ ìˆ˜í•™ì˜ ì§„ì§œ ì¬ë¯¸ë¥¼ ëŠë‚„ ìˆ˜ ìˆì„ ê±°ì•¼.
                ìƒ˜ì€ í•­ìƒ ë„ˆì˜ ê°€ëŠ¥ì„±ì„ ë¯¿ê³  ì‘ì›í•˜ê³  ìˆìœ¼ë‹ˆê¹Œ, ì–¸ì œë“  ì–´ë ¤ìš´ ì ì´ ìˆê±°ë‚˜ ê³ ë¯¼ì´ ìƒê¸°ë©´ ì£¼ì €í•˜ì§€ ë§ê³ 
                ìƒ˜í•œí…Œ í¸í•˜ê²Œ ì´ì•¼ê¸°í•´! ìš°ë¦¬ ê°™ì´ íŒŒì´íŒ… í•´ë³´ì!</p>
                <p style="font-weight: bold; color: #9b59b6; margin-top: 20px;">"ì—´ì‹¬íˆ í•˜ëŠ” ë„ˆì˜ ì˜¤ëŠ˜ì´ ë¹›ë‚˜ëŠ” ë‚´ì¼ì„ ë§Œë“¤ ê±°ì•¼!"</p>
                <div class="teacher-signature">â€“ ë„ˆì˜ ì„±ì¥ì„ í•­ìƒ ì‘ì›í•˜ëŠ”, ê°•ì„T â€“</div>
            `;
            container.appendChild(commentBox);
        }

        // ëœë¤ ì½”ë“œ ìƒì„± (6ìë¦¬)
        function generateRandomCode() {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // HTML ì €ì¥ (ê³µìœ ìš©)
        function saveAsHTML() {
            console.log('saveAsHTML í•¨ìˆ˜ í˜¸ì¶œë¨');
            // í˜„ì¬ í•™ìƒ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const studentName = document.getElementById('studentName').textContent;
            console.log('í•™ìƒ ì´ë¦„:', studentName);

            if (!studentName || studentName === '-') {
                alert('ë¨¼ì € ì˜¤ë‹µë³´ê³ ì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ëœë¤ ì½”ë“œ ìƒì„±
            const randomCode = generateRandomCode();
            const fileName = 'report_' + studentName + '_' + randomCode + '.html';

            // ì°¨íŠ¸ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
            const chartCanvas = document.getElementById('ratioChart');
            let chartImageData = '';

            if (chartCanvas && ratioChart) {
                chartImageData = chartCanvas.toDataURL('image/png');
            }

            // í˜„ì¬ HTML ë³µì‚¬
            const htmlContent = document.documentElement.cloneNode(true);

            // ì°¨íŠ¸ë¥¼ ì´ë¯¸ì§€ë¡œ êµì²´
            if (chartImageData) {
                const chartContainer = htmlContent.querySelector('.chart-container');
                if (chartContainer) {
                    const canvas = chartContainer.querySelector('canvas');
                    if (canvas) {
                        // ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ êµì²´
                        const img = document.createElement('img');
                        img.src = chartImageData;
                        img.style.maxWidth = '100%';
                        img.style.height = 'auto';
                        canvas.parentNode.replaceChild(img, canvas);
                    }
                }
            }

            // ì…ë ¥ ì„¹ì…˜ ì œê±°
            const inputSection = htmlContent.querySelector('#inputSection');
            if (inputSection) {
                inputSection.remove();
            }

            // ê²°ê³¼ ì„¹ì…˜ì„ í•­ìƒ ë³´ì´ë„ë¡
            const resultSection = htmlContent.querySelector('#resultSection');
            if (resultSection) {
                resultSection.classList.add('show');
            }

            // ë²„íŠ¼ ì•¡ì…˜ ì œê±° (HTML ì €ì¥ ë²„íŠ¼ ì œê±°)
            const btnActions = htmlContent.querySelector('.btn-actions');
            if (btnActions) {
                btnActions.remove();
            }

            // Chart.js ìŠ¤í¬ë¦½íŠ¸ ì œê±° (ë” ì´ìƒ í•„ìš” ì—†ìŒ)
            const scripts = htmlContent.querySelectorAll('script');
            scripts.forEach(script => {
                const src = script.getAttribute('src');
                if (src && src.includes('chart.js')) {
                    script.remove();
                }
            });

            // HTML ë¬¸ìì—´ë¡œ ë³€í™˜
            const htmlString = '<!DOCTYPE html>\n' + htmlContent.outerHTML;

            // Blob ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([htmlString], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // localStorageì— ì €ì¥ëœ ë¦¬í¬íŠ¸ ì •ë³´ ì¶”ê°€
            saveReportToLocalStorage(fileName, studentName);

            // ì„±ê³µ ë©”ì‹œì§€
            const deployPath = 'C:\\Users\\Owner\\academy-management\\deploy\\';
            alert('âœ… ì €ì¥ ì™„ë£Œ!\n\n' +
                  'íŒŒì¼ëª…: ' + fileName + '\n\n' +
                  'ğŸ“ ë‹¤ìŒ ë‹¨ê³„:\n' +
                  '1. ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì„ ë‹¤ìŒ í´ë”ë¡œ ì´ë™í•˜ì„¸ìš”:\n' +
                  '   ' + deployPath + '\n\n' +
                  '2. í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰:\n' +
                  '   node generate-reports-list.js\n\n' +
                  '3. deploy í´ë”ë¥¼ Netlifyì— ì—…ë¡œë“œ');
        }

        // ë¦¬í¬íŠ¸ ì •ë³´ë¥¼ localStorageì— ì €ì¥
        function saveReportToLocalStorage(fileName, studentName) {
            let savedReports = JSON.parse(localStorage.getItem('savedReports') || '[]');

            // ì¤‘ë³µ ì²´í¬ (ê°™ì€ í•™ìƒ ì´ë¦„ì´ ìˆìœ¼ë©´ ì œê±°)
            savedReports = savedReports.filter(report => report.studentName !== studentName);

            // ìƒˆë¡œìš´ ë¦¬í¬íŠ¸ ì¶”ê°€
            savedReports.push({
                fileName: fileName,
                studentName: studentName,
                timestamp: new Date().toISOString()
            });

            localStorage.setItem('savedReports', JSON.stringify(savedReports));
        }

        // ë°°í¬ìš© index.html ìƒì„±
        function generateIndexHTML() {
            const savedReports = JSON.parse(localStorage.getItem('savedReports') || '[]');

            if (savedReports.length === 0) {
                alert('ì €ì¥ëœ í•™ìƒ ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.\në¨¼ì € í•™ìƒë³„ HTMLì„ ì €ì¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // í•™ìƒ ì´ë¦„ìˆœìœ¼ë¡œ ì •ë ¬
            savedReports.sort((a, b) => a.studentName.localeCompare(b.studentName, 'ko'));

            // í•™ìƒ ì¹´ë“œ HTML ìƒì„±
            let studentCards = '';
            savedReports.forEach(report => {
                studentCards += '            <a href="' + report.fileName + '" class="student-card">\n';
                studentCards += '                <div class="student-icon">ğŸ‘¤</div>\n';
                studentCards += '                <div class="student-name">' + report.studentName + '</div>\n';
                studentCards += '            </a>\n';
            });

            // index.html ìƒì„± (ë¬¸ìì—´ ì—°ê²° ë°©ì‹)
            let indexHTML = '<!DOCTYPE html>\n';
            indexHTML += '<html lang="ko">\n';
            indexHTML += '<head>\n';
            indexHTML += '    <meta charset="UTF-8">\n';
            indexHTML += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
            indexHTML += '    <title>ë‹¤ì‚°ë¯¸ë˜í•™ì› ì˜¤ë‹µë³´ê³ ì„œ - í•™ìƒ ì„ íƒ</title>\n';
            indexHTML += '    <style>\n';
            indexHTML += '        * { margin: 0; padding: 0; box-sizing: border-box; }\n';
            indexHTML += '        body { font-family: "Malgun Gothic", sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 40px 20px; display: flex; align-items: center; justify-content: center; }\n';
            indexHTML += '        .container { max-width: 800px; width: 100%; background: white; border-radius: 20px; padding: 50px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }\n';
            indexHTML += '        .header { text-align: center; margin-bottom: 50px; }\n';
            indexHTML += '        .header h1 { color: #3498db; font-size: 2.5em; margin-bottom: 15px; }\n';
            indexHTML += '        .header h2 { color: #9b59b6; font-size: 1.5em; margin-bottom: 10px; }\n';
            indexHTML += '        .header p { color: #7f8c8d; font-size: 1.1em; margin-top: 20px; }\n';
            indexHTML += '        .student-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 30px; }\n';
            indexHTML += '        .student-card { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 12px; padding: 25px; text-align: center; transition: all 0.3s; cursor: pointer; border: 3px solid transparent; text-decoration: none; display: block; }\n';
            indexHTML += '        .student-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); border-color: #3498db; }\n';
            indexHTML += '        .student-icon { font-size: 3em; margin-bottom: 15px; }\n';
            indexHTML += '        .student-name { color: #2c3e50; font-size: 1.3em; font-weight: bold; }\n';
            indexHTML += '        .footer { text-align: center; margin-top: 50px; padding-top: 30px; border-top: 2px solid #ecf0f1; color: #7f8c8d; }\n';
            indexHTML += '    </style>\n';
            indexHTML += '</head>\n';
            indexHTML += '<body>\n';
            indexHTML += '    <div class="container">\n';
            indexHTML += '        <div class="header">\n';
            indexHTML += '            <h1>ë‹¤ì‚°ë¯¸ë˜í•™ì› * ê°•ì„T</h1>\n';
            indexHTML += '            <h2>ì˜¤ë‹µë³´ê³ ì„œ ì‹œìŠ¤í…œ</h2>\n';
            indexHTML += '            <p>ğŸ“š ìì‹ ì˜ ì´ë¦„ì„ í´ë¦­í•˜ì—¬ ì˜¤ë‹µë³´ê³ ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”</p>\n';
            indexHTML += '        </div>\n';
            indexHTML += '        <div class="student-list">\n';
            indexHTML += studentCards;
            indexHTML += '        </div>\n';
            indexHTML += '        <div class="footer">\n';
            indexHTML += '            <p>Â© 2025 ë‹¤ì‚°ë¯¸ë˜í•™ì› | ê°•ì„T</p>\n';
            indexHTML += '            <p style="margin-top: 10px; font-size: 0.9em;">ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”</p>\n';
            indexHTML += '        </div>\n';
            indexHTML += '    </div>\n';
            indexHTML += '</body>\n';
            indexHTML += '</html>';

            // Blob ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([indexHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('âœ… index.html ìƒì„± ì™„ë£Œ!\n\nì´ ' + savedReports.length + 'ëª…ì˜ í•™ìƒì´ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ì œ ë‹¤ìŒ ìˆœì„œë¡œ ì§„í–‰í•˜ì„¸ìš”:\n\n1. ëª¨ë“  í•™ìƒ HTML íŒŒì¼ì„ í•œ í´ë”ì— ëª¨ìœ¼ê¸°\n2. ë°©ê¸ˆ ìƒì„±ëœ index.htmlë„ ê°™ì€ í´ë”ì— ë„£ê¸°\n3. í´ë”ë¥¼ Netlify Dropì— ì—…ë¡œë“œ\n4. ìƒì„±ëœ URLì„ ê° í•™ìƒì—ê²Œ ì „ë‹¬\n   (ì˜ˆ: https://abc123.netlify.app/report_ì´ì±„ì›_a8k3m2.html)');
        }

        // í•™ìƒ ì •ë³´ ë¡œë“œ (student.txt)
        async function loadStudentData() {
            try {
                const response = await fetch('student.txt');
                const text = await response.text();
                const lines = text.trim().split('\n');

                let currentStudent = null;
                let currentData = {};

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();

                    // ìƒˆë¡œìš´ í•™ìƒ ì‹œì‘ (â–ªï¸ë¡œ ì‹œì‘)
                    if (line.startsWith('â–ªï¸')) {
                        // ì´ì „ í•™ìƒ ë°ì´í„° ì €ì¥
                        if (currentStudent && currentData.grade) {
                            studentData[currentStudent] = currentData;
                        }

                        // ìƒˆ í•™ìƒ ì •ë³´ íŒŒì‹±: â–ªï¸ ì´ì±„ì› (ë„ë†ê³ ) 1í•™ë…„
                        const match = line.match(/â–ªï¸\s*(.+?)\s*\((.+?)\)\s*(\d+)í•™ë…„/);
                        if (match) {
                            currentStudent = match[1].trim();
                            const school = match[2].trim();
                            const gradeNum = match[3];

                            currentData = {
                                grade: `ê³ ${gradeNum}`,
                                school: school,
                                talentLevel: "",
                                personalityType: "",
                                weaknessTypes: [],
                                comment: ""
                            };
                        }
                    }
                    // ìˆ˜í•™ ì¬ëŠ¥ ë‹¨ê³„
                    else if (line.includes('ìˆ˜í•™ ì¬ëŠ¥ ë‹¨ê³„:')) {
                        const value = line.split(':')[1].trim();
                        currentData.talentLevel = value;
                    }
                    // ì„±ê²© ìœ í˜•
                    else if (line.includes('ì„±ê²© ìœ í˜•:')) {
                        const value = line.split(':')[1].trim();
                        currentData.personalityType = value;
                    }
                    // ìˆ˜í•™ë¬¸ì œ í‹€ë¦¬ëŠ” ìœ í˜•
                    else if (line.includes('ìˆ˜í•™ë¬¸ì œ í‹€ë¦¬ëŠ” ìœ í˜•')) {
                        const value = line.split(':')[1].trim();
                        // ì‰¼í‘œë¡œ ë¶„ë¦¬
                        const types = value.split(',').map(t => t.trim()).filter(t => t);
                        currentData.weaknessTypes = types;
                    }
                    // í•œì¤„ ë©˜íŠ¸
                    else if (line.startsWith('ğŸ“Œ')) {
                        const value = line.replace('ğŸ“Œ', '').replace('í•œì¤„ ë©˜íŠ¸:', '').trim();
                        currentData.comment = value;
                    }
                }

                // ë§ˆì§€ë§‰ í•™ìƒ ì €ì¥
                if (currentStudent && currentData.grade) {
                    studentData[currentStudent] = currentData;
                }

                console.log('âœ… í•™ìƒ ì •ë³´ ë¡œë“œ ì™„ë£Œ:', Object.keys(studentData).length, 'ëª…');
                console.log(studentData);

                // í•™ìƒ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
                const studentSelect = document.getElementById('studentSelect');
                Object.keys(studentData).forEach(studentName => {
                    const option = document.createElement('option');
                    option.value = studentName;
                    option.textContent = studentName;
                    studentSelect.appendChild(option);
                });

                console.log('âœ… í•™ìƒ ë“œë¡­ë‹¤ìš´ ìƒì„± ì™„ë£Œ');

            } catch (error) {
                console.error('âŒ í•™ìƒ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('í•™ìƒ ì •ë³´ íŒŒì¼(student.txt)ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ê¸°ëŠ¥ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        }


        // ë‹¨ì› ì •ë³´ ë¡œë“œ
        async function loadUnitInfo() {
            try {
                const response = await fetch('ë‹¨ì›ì •ë³´.txt');
                const text = await response.text();
                const lines = text.trim().split('\n');

                const unitSelect = document.getElementById('unitSelect');

                lines.forEach(line => {
                    if (line.trim()) {
                        // "1. í‰ë©´ì¢Œí‘œ" í˜•ì‹ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ
                        const match = line.trim().match(/^(\d+)\.\s*(.+)/);
                        if (match) {
                            const unitNumber = match[1];
                            const unitName = line.trim();

                            const option = document.createElement('option');
                            option.value = unitNumber;
                            option.textContent = unitName;
                            unitSelect.appendChild(option);
                        }
                    }
                });

                console.log('âœ… ë‹¨ì› ì •ë³´ ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ë‹¨ì› ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                console.log('í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ ë‹¨ì› ëª©ë¡ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ë‹¨ì› ëª©ë¡ ì¶”ê°€ (í´ë°±)
                const defaultUnits = [
                    {value: '1', text: '1. í‰ë©´ì¢Œí‘œ'},
                    {value: '2', text: '2. ì§ì„ ì˜ ë°©ì •ì‹'},
                    {value: '3', text: '3. ì›ì˜ ë°©ì •ì‹'},
                    {value: '4', text: '4. ë„í˜•ì˜ ì´ë™'},
                    {value: '5', text: '5. ì§‘í•©'},
                    {value: '6', text: '6. ì§‘í•©ì˜ ì—°ì‚°'},
                    {value: '7', text: '7. ëª…ì œ'},
                    {value: '8', text: '8. ì ˆëŒ€ë¶€ë“±ì‹'}
                ];
                const unitSelect = document.getElementById('unitSelect');
                defaultUnits.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit.value;
                    option.textContent = unit.text;
                    unitSelect.appendChild(option);
                });
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“š ì„¤ì • íŒŒì¼ ë¡œë“œ ì‹œì‘...');
            loadStudentData();
            loadUnitInfo();
        });
    </script>
</body>
</html>
